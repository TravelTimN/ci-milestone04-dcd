{% block css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin="" type="text/css">
{% endblock %}


<!-- the map -->
<div id="map"></div>


{% block js %}
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>

<script>
    // generate the map
    let map = L.map("map", {
        layers: L.tileLayer("http://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"),
        maxBounds: [[-75, -225], [90, 225]],
        maxBoundsViscosity: 0.5,
        minZoom: 2,
        maxZoom: 18
    });

    // add each visitor marker to the map
    let markers = [];
    let marker;
    let flagIcon;
    {% for visitor in visitor_list %}
        // set each marker to the country flag (https://www.countryflags.io/)
        flagIcon = new L.Icon({
            iconUrl: "https://www.countryflags.io/{{ visitor.iso2 }}/flat/24.png"
        });
        marker = L.marker([{{ visitor.latitude }}, {{ visitor.longitude }}])
            .bindTooltip("IP: {{ visitor.ip }}<br>{{ visitor.city }}, {{ visitor.country }}")
            .addTo(map);
        markers.push(marker);  // push marker to markers array
        marker.setIcon(flagIcon);  // set flag icon to marker
    {% endfor %}
    let featureGroup = L.featureGroup(markers);
    map.fitBounds(featureGroup.getBounds());  // get bounds of all markers

</script>
{% endblock %}
